using System;
using System.Text;
using System.Web;
using System.Web.UI;

namespace Lista3
{
    public partial class ApiDemo : AuthPage
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            // 1) Odczyt nagłówków żądania
            var headers = Request.Headers;
            var sb = new StringBuilder();
            sb.AppendLine("<ul>");
            foreach (string key in headers)
            {
                var val = headers[key] ?? string.Empty;
                sb.AppendFormat("<li><strong>{0}</strong>: {1}</li>",
                    HttpUtility.HtmlEncode(key),
                    HttpUtility.HtmlEncode(val));
            }
            sb.AppendLine("</ul>");
            RequestHeadersLiteral.Text = sb.ToString();

            // 2) Dodanie własnego nagłówka odpowiedzi
            Response.AddHeader("X-MyApp-Info", "ApiDemo;ts=" + DateTime.UtcNow.ToString("o"));
            lblResponseHeaderInfo.Text = "Dodano nagłówek 'X-MyApp-Info' z wartością znacznikową (UTC).";

            // 3) Mapowanie ścieżki względnej na fizyczną (Server.MapPath)
            string relative = "~/App_Data"; // przykładowa ścieżka względem katalogu aplikacji
            string physical = Server.MapPath(relative);
            bool exists = System.IO.Directory.Exists(physical) || System.IO.File.Exists(physical);
            MappedPathLiteral.Text = HttpUtility.HtmlEncode(relative) + " -> " + HttpUtility.HtmlEncode(physical) + (exists ? " (istnieje)" : " (nie istnieje)");

            // 4) HttpContext.Current - statyczne odniesienie do bieżącego kontekstu
            var ctx = HttpContext.Current;
            if (ctx != null)
            {
                HttpContextInfoLiteral.Text = "HttpContext.Current dostępny. Request.Url = " + HttpUtility.HtmlEncode(ctx.Request.Url.ToString());
            }
            else
            {
                HttpContextInfoLiteral.Text = "HttpContext.Current jest null (niektóre niestandardowe wątki lub kontekstowe operacje mogą go nie udostępniać).";
            }
        }
    }
}
